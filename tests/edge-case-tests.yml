name: Edge Case Tests
on:
  workflow_dispatch:
  
jobs:
  test-vulnerability-only:
    runs-on: ubuntu-latest
    name: Test Vulnerability Only
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test vulnerability-only scan
        uses: ./
        with:
          falcon_client_id: ${{ secrets.FALCON_CLIENT_ID }}
          falcon_client_secret: ${{ secrets.FALCON_CLIENT_SECRET }}
          falcon_region: ${{ secrets.FALCON_REGION }}
          scan_type: image
          image: alpine:latest
          vulnerability_only: true
          output_path: ./vuln-results/
          report_formats: json,sarif
          minimum_score: 7.0
      
      - name: Upload vulnerability results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: vulnerability-test-results
          path: ./vuln-results/

  test-sbom-only:
    runs-on: ubuntu-latest
    name: Test SBOM Only
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test SBOM-only scan
        uses: ./
        with:
          falcon_client_id: ${{ secrets.FALCON_CLIENT_ID }}
          falcon_client_secret: ${{ secrets.FALCON_CLIENT_SECRET }}
          falcon_region: ${{ secrets.FALCON_REGION }}
          scan_type: image
          image: redis:alpine
          sbom_only: true
          output_path: ./sbom-results/
          report_formats: sbom-cylconedx
      
      - name: Upload SBOM results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: sbom-test-results
          path: ./sbom-results/

  test-upload-functionality:
    runs-on: ubuntu-latest
    name: Test Upload to Falcon
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test upload to Falcon Console
        uses: ./
        with:
          falcon_client_id: ${{ secrets.FALCON_CLIENT_ID }}
          falcon_client_secret: ${{ secrets.FALCON_CLIENT_SECRET }}
          falcon_region: ${{ secrets.FALCON_REGION }}
          scan_type: image
          image: python:3.9-slim
          upload_results: true
          output_path: ./upload-results/
          report_formats: json
          minimum_severity: low
      
      - name: Upload scan results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: upload-test-results
          path: ./upload-results/
